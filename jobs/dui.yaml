apiVersion: batch/v1
kind: CronJob
metadata:
  name: dui
  namespace: jobs
spec:
  schedule: '12 */1 * * *'
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          volumes:
          - name: dui
            iscsi:
              iqn: iqn.2014-09.com.radoncanyon:nas1:dui
              targetPortal: 192.168.220.149
              lun: 1
              fsType: ext4
          - name: dui-config
            secret:
              secretName: dui-config
          - name: dui-rclone-config
            secret:
              secretName: dui-rclone-config
          initContainers:
          - name: dui
            image: docker.io/nlopez/dui:4
            env:
              - name: DUI_INI
                value: /dui/config/dui.ini
            volumeMounts:
            - name: dui
              mountPath: /dui
            - name: dui-config
              mountPath: /dui/config
              readOnly: true
          - name: rclone
            image: docker.io/rclone/rclone:1.53.3
            args:
            - --config
            - /config/rclone.conf
            - copy
            - --progress
            - /dui/data
            - Nextcloud:/dui
            volumeMounts:
            - name: dui
              mountPath: /dui
              readOnly: true
            - name: dui-rclone-config
              mountPath: /config
              readOnly: true
          containers:
          - name: hc-ping
            image: buildpack-deps:bionic-curl
            command: ["/usr/bin/curl"]
            args:
            - --retry
            - '3'
            - https://hc-ping.com/4bb27667-5f75-46ed-ac59-a1a04dd54008
          restartPolicy: Never
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: dui-config
  namespace: jobs
spec:
  encryptedData:
    dui.ini: AgCuUaeqii2ook6/b1wvNgdrb7rNJZsSgNP1CQtnI7/pKcMOmBVIbD9P/LiQPxrCx2a24I/tKjsh061QFr964jmGU1u2Cy2+5xvpbdN1Fk5PvWc3tCX8mMWZlYRlWUBgVj3BTD21AvVIs/8SuGJ+SZFeQLLVTjRUbIFg2NJWx4ePYHq22D2Q7Z3EvC/c2KcwMyjywKeeJBYrAhy6romtWuQer8GMziUagFs5qUJR3+wgZGUFPcyR27IvYy+fglhTqLnxH1BsjBxiYWpHhuM4LtZ++61x9OIiN5XCJxd7hp4+MVo9vnixBlE+H9AMjgdu2k0IYCFECGUEgGQ+DR7xiKNf7M0EOhvePgqHyoYTTzI/5f8Q3wBo59zb0/+3mv4Np1/+ytUdj7gCqhfZ5p2DRYLPYLvK+K5VPFCTvCF04FdBvcw7oeWcGCMpZqdoHxStX47bav3/R3EXUPLqWGvXtpWlqksee4Czp8YF7rGYv8tNtBcBNr9XHcdNc1QC28KESuxSJkvUmNqa6J5xOZNgthXZYZ9bOqRKNkomvLraqlqesltUKNYXN71e1B15b2pHLmgOF8YF8ibn5SfeNGzE9AVjKObTrYR10H0iDpl17R8N+RjniR+goMJqVqU3a+TwvVfd26CmhPF8mFAR0MOAfQZIe4aMwbqBalcgp8UxEWlOSN6qQOMPN1HeXqOkBzAbAMMUo8geJ4iQfsKIYCOrI4u9cNfpDaHqJHZ1ahBp941oRl/kWlhhiDM8nIGUU4aRInwap2DLd8XyKroaTS6rdpVXf8HRuF/zQUtqUWw3/2WmEPf2uoERU8X8vn7FIUP/sGU1eQ940Qp66S/qVZB28UFWU4n0Ju5aFy5HpYx6yGpI61LxjwU8LLwjU8+f959RA47dt3MPEybA0Oe64IB/VvEd4wDYKDG3nWFBzEoQOtc+In8GdDp8HmicgfQ/jNN+T2z464xPRnQOyo6tHXfMtOMXEM+vcU+lo63Mj8177veU8koFE1aJf8Xpt7qcL/2BUHyTecm1KzfMfltkFdGqW6UTPegLJ9y9o/315pxgtTbUH6OzlJFz6cz/R43fPBfeD9DWnCEeLk7ADNTcmw54SQDkfcI6dpdU9FH39UvGHLTN2ewAMMxss6O8fjnGyVdFHlxSjvmNP4i1QYVQZz1V9X5xOWWrbKhiJxW1ddWF4J2ydQSUjY113+njKDLTphnEiVU+YwCqtH3euySqai01UlX2u4r/1yCU9CTsrl5a5VuaZIXWxSDb+gk=
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: dui-config
      namespace: jobs
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: dui-rclone-config
  namespace: jobs
spec:
  encryptedData:
    rclone.conf: AgALO2K6E+L1aVt93oMIuGUuo2reS+ncsBNxuR/+fuced27cO9RQOynnnhpO684UhhE8KaV71mZdOdwp/ziBwPEi+uV90I6Pq/HXzL+8b0IWwKNaXb0X9zygV7ahIJsqz+hksRBPi84NFk091GdeCnP6OJybJf8XB8D6r9qvCgA6zlmcs62eLzpP5QGIYDwZviZaWudAS11soRd5jpPbrL4Nf5x0lrKVxgjd5C6+vQ0PMglO6e0Yf/yxrC133JU60JywnWXihBy/n0vry8AuTN1Uwby+n2U8/bFGWf3//GxhTvUbx5CBGxL2GieJsESVhOxirsGcBzqR271xhhevfdxlKPzSzBskDp/EjdiBBiyZ9TpdTqgbvCyr3wPP1rriUNXxHntbEm2FzEkoXWVVtPHHVlFYrBHm6XsUFtqXx6nesa5JqyuyDmFopwSG3C6AiHEq96j5DJykQKKQbYUeOnpWoEtFt8lbyDscDJSKlETeSnc+Fa0J/wp1mdbZYhauGrUpyNUO9RTJ73DhKfwe5BJMbDA1RiXC57rZGEbjxiAKxAQohw4qLShDEAWgudyhlwcV0Fl5Vt/mT68/tKCClumxg9gJCf4gQCj4GVkb82dDle5n6atHh+qg66JO9lYJvcgvl2F75ntQEKYlxZxyI3VR2SBG3mkhqCiEhizvaz+r0WuJ3NURyCTxsLWD+jWU2hsABN+18Umj1tgWTnPBjfFC9Es3XLPO9jBAz9aedfcTS9J9bZOnzoeeWgy6m0/ENRDWiQjHOdP+cTr2pz9UtC0epxLcPU13h7ur4aon8qpHBbEZ1E2pGudVXKgVe/10Z54T6yM1OmKzotOhlefSrB7vfUlsahFphGxywRqm21ObOwUCEOXwEP7/jg0//YuOEwfrbcpeWiZWyjCw5f9NXKEmSdYg8jDeFZ1ppB7iEojAc+0=
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: dui-rclone-config
      namespace: jobs
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: dui-cache-clear
  namespace: jobs
spec:
  schedule: '0 0 * * 0'  # at 00:00 on Sunday
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          volumes:
          - name: dui
            iscsi:
              iqn: iqn.2014-09.com.radoncanyon:nas1:dui
              targetPortal: 192.168.220.149
              lun: 1
              fsType: ext4
          containers:
          - name: dui
            image: nlopez/dui:4
            command: ["sh"]
            args: ["-c" , "rm -rfv /dui/*"]
            volumeMounts:
            - name: dui
              mountPath: /dui
          restartPolicy: Never
