---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: internal-ingress-nginx
  namespace: argocd
spec:
  syncPolicy:
    automated:
      selfHeal: false
  destination:
    namespace: ingress-nginx
    server: {{ .Values.spec.destination.server }}
  project: default
  source:
    repoURL: https://kubernetes.github.io/ingress-nginx/
    chart: ingress-nginx
    # https://github.com/kubernetes/ingress-nginx/blob/main/charts/ingress-nginx/CHANGELOG.md
    targetRevision: 4.3.0
    # https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/charts/ingress-nginx/values.yaml
    helm:
      values: |
        defaultBackend:
          enabled: "true"
        controller:
          service:
            externalTrafficPolicy: "Local"
            loadBalancerIP: "192.168.222.232"
          kind: DaemonSet
          podAnnotations:
            ad.datadoghq.com/controller.check_names: '["nginx_ingress_controller"]'
            ad.datadoghq.com/controller.init_configs: '[{}]'
            ad.datadoghq.com/controller.instances: '[{"prometheus_url": "http://%%host%%:10254/metrics"}]'
            ad.datadoghq.com/controller.logs: '[{"service": "controller", "source": "nginx-ingress-controller"}]'
          ingressClassResource:
            name: internal-nginx
            enabled: true
            default: false
            controllerValue: "k8s.io/internal-ingress-nginx"
          config:
            server-tokens: "false"
          extraArgs: {}
          extraVolumes: {}
          extraVolumeMounts: {}
